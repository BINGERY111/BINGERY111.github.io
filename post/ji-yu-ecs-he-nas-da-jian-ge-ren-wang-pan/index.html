<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" >

<title>基于ECS和NAS搭建个人网盘 | 个人笔记</title>

<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">

<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.7.2/css/all.css" integrity="sha384-fnmOCqbTlWIlj8LyTjo7mOUStjsKC4pOpQbqyi7RrhN7udi9RwhKkMHpvLbHG9Sr" crossorigin="anonymous">
<link rel="shortcut icon" href="https://bingery111.github.io/favicon.ico?v=1646641073762">
<link rel="stylesheet" href="https://bingery111.github.io/styles/main.css">



<link rel="stylesheet" href="https://unpkg.com/aos@next/dist/aos.css" />
<script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>



    <meta name="description" content="目标
1、NAS文件存储系统基本知识
2、 Apache + PHP语言环境的安装和部署
3 、挂载NAS文件存储系统
4、 Linux 系统基础命令
NAS
文件存储NAS：提供标准的文件访问协议，用户无需对现有应用做任何修改，即可使用具..." />
    <meta name="keywords" content="" />
  </head>
  <body>
    <div id="app" class="main">

      <div class="sidebar" :class="{ 'full-height': menuVisible }">
  <div class="top-container" data-aos="fade-right">
    <div class="top-header-container">
      <a class="site-title-container" href="https://bingery111.github.io">
        <img src="https://bingery111.github.io/images/avatar.png?v=1646641073762" class="site-logo">
        <h1 class="site-title">个人笔记</h1>
      </a>
      <div class="menu-btn" @click="menuVisible = !menuVisible">
        <div class="line"></div>
      </div>
    </div>
    <div>
      
        
          <a href="/" class="site-nav">
            首页
          </a>
        
      
        
          <a href="/archives" class="site-nav">
            归档
          </a>
        
      
        
          <a href="/tags" class="site-nav">
            标签
          </a>
        
      
        
          <a href="/post/about" class="site-nav">
            关于
          </a>
        
      
    </div>
  </div>
  <div class="bottom-container" data-aos="flip-up" data-aos-offset="0">
    <div class="social-container">
      
        
      
        
      
        
      
        
      
        
      
    </div>
    <div class="site-description">
      向上攀爬之路不是比站在顶峰更让人热血澎湃吗
    </div>
    <div class="site-footer">
      Powered by <a href="https://github.com/getgridea/gridea" target="_blank">Gridea</a> | <a class="rss" href="https://bingery111.github.io/atom.xml" target="_blank">RSS</a>
    </div>
  </div>
</div>


      <div class="main-container">
        <div class="content-container" data-aos="fade-up">
          <div class="post-detail">
            <h2 class="post-title">基于ECS和NAS搭建个人网盘</h2>
            <div class="post-date">2022-02-18</div>
            
            <div class="post-content" v-pre>
              <h3 id="目标">目标</h3>
<p>1、NAS文件存储系统基本知识<br>
2、 Apache + PHP语言环境的安装和部署<br>
3 、挂载NAS文件存储系统<br>
4、 Linux 系统基础命令</p>
<h3 id="nas">NAS</h3>
<p>文件存储NAS：提供标准的文件访问协议，用户无需对现有应用做任何修改，即可使用具备无限容量及性能扩展、单一命名空间、多共享、高可靠和高可用等特性的分布式文件系统。</p>
<p><strong>优点：</strong><br>
1、标准文件协议，既支持NFS也支持SMB<br>
2、共享、无限扩容、高可靠<br>
3、良好的性能指标，支持横向拓展</p>
<h3 id="应用">应用</h3>
<p>1、启动创建好的ECS<br>
2、安装OwnCloud<br>
OwnCloud是一款开源的云存储软件，基于PHP的自建网盘。基本上是私人使用，没有用户注册功能，但是有用户添加功能，你可以无限制地添加用户，OwnCloud支持多个平台（windows，MAC，Android，IOS，Linux）。<br>
3、打开终端，添加软件</p>
<pre><code>cd /etc/yum.repos.d/
wget --no-check-certificate https://download.opensuse.org/repositories/isv:ownCloud:server:10/CentOS_7/isv:ownCloud:server:10.repo
</code></pre>
<p>4、进入root目录，安装OwnCloud-files</p>
<pre><code>cd /root/
yum -y install https://labfileapp.oss-cn-hangzhou.aliyuncs.com/owncloud-complete-files-10.5.0-3.1.noarch.rpm
</code></pre>
<p>5、查看安装是否成功</p>
<pre><code>ll /var/www/html
</code></pre>
<p>6、安装Apache服务</p>
<ul>
<li>执行以下命令安装Apache服务</li>
</ul>
<pre><code>yum install httpd -y
</code></pre>
<ul>
<li>执行以下命令启动Apache服务。</li>
</ul>
<pre><code>systemctl start httpd.service
</code></pre>
<ul>
<li>浏览器输入ECS弹性公网ip，即可</li>
<li>添加OwnCloud配置</li>
</ul>
<pre><code>vim /etc/httpd/conf/httpd.conf
</code></pre>
<ul>
<li>在<Directory>内容后添加以下内容</li>
</ul>
<pre><code># owncloud config
Alias /owncloud &quot;/var/www/html/owncloud/&quot;
&lt;Directory /var/www/html/owncloud/&gt;
    Options +FollowSymlinks
    AllowOverride All
    &lt;IfModule mod_dav.c&gt;
        Dav off
    &lt;/IfModule&gt;
    SetEnv HOME /var/www/html/owncloud
    SetEnv HTTP_HOME /var/www/html/owncloud
&lt;/Directory&gt;
</code></pre>
<p>7、安装、配置PHP<br>
OwnCloud是基于PHP开发的云存储软件，需要PHP运行环境</p>
<ul>
<li>执行以下命令手动更新rpm源</li>
</ul>
<pre><code>rpm -Uvh https://labfileapp.oss-cn-hangzhou.aliyuncs.com/epel-release-latest-7.noarch.rpm 
rpm -Uvh https://labfileapp.oss-cn-hangzhou.aliyuncs.com/webtatic-release.rpm 
</code></pre>
<ul>
<li>执行以下命令安装PHP 7.2版本</li>
</ul>
<pre><code>yum -y install php72w
yum -y install php72w-cli php72w-common php72w-devel php72w-mysql php72w-xml php72w-odbc php72w-gd php72w-intl php72w-mbstring
</code></pre>
<ul>
<li>将PHP配置到Apache中</li>
</ul>
<pre><code>find / -name php.ini
</code></pre>
<ul>
<li>执行以下命令打开httpd.conf文件</li>
</ul>
<pre><code>vi /etc/httpd/conf/httpd.conf
</code></pre>
<ul>
<li>在文件最后添加上</li>
</ul>
<pre><code>PHPIniDir /etc/php.ini
</code></pre>
<ul>
<li>重启Apache服务</li>
</ul>
<pre><code>systemctl restart httpd.service
</code></pre>
<p>8、配置OwnCloud</p>
<ul>
<li>登录OwnCloud创建个人网盘了</li>
<li>打开用户本地浏览器，输入ECS弹性IP/owncloud</li>
<li>自定义输入管理员账号和密码，然后单击存储&amp;数据库，选择SQLite，最后单击安装完成</li>
</ul>
<p>9、挂载NAS服务</p>
<ul>
<li>1、完成OwnCloud初始化之后就可以将NAS存储包挂载到您的网盘服务器上</li>
<li></li>
<li>2、打开无痕浏览器页面，复制 云产品资源 列表中 「一键复制子账号登陆链接」 粘贴到浏览器，输入 云产品资源列表 中的子账号密码，即可登录当前子账号。</li>
<li></li>
<li>3、输入云产品资源提供的子用户名和密码，登录阿里云控制台。在产品列表页，搜索NAS，然后单击文件存储NAS</li>
<li></li>
<li>4、在左侧导航栏中，单击文件系统列表。在页面上方，选择资源提供的地域 ，例如：华东2 上海。在文件系统列表页面，可以根据云产品资源列表中提供的nasFileSystemId找到您的NAS资源，然后单击文件系统 ID，进入文件系统详情页</li>
<li></li>
<li>5、选择挂载使用，然后单击添加挂载点，专有网络选择cn-shanghai-vpc-csn、交换机选择cn-shanghai-b-csn和权限组选择VPC默认权限组，最后单击确定</li>
<li></li>
<li>6、切换至命令行终端页面，执行以下命令安装cifs-utils工具包</li>
<li></li>
</ul>
<pre><code>sudo yum -y install cifs-utils
</code></pre>
<ul>
<li>7、执行以下命令，查看apache的uid和gid</li>
</ul>
<pre><code>cat /etc/passwd|grep apache
</code></pre>
<ul>
<li>
<p>8、切换至无痕浏览器，在文件存储NAS控制台页签，单击通过命令行挂载到ECS，挂载文件系统选择Linux，在Linux ECS上安装CIFS客户端选择Centos，查看挂载SMB文件系统命令</p>
</li>
<li>
<p>9、复制挂载SMB文件系统的命令，并且您需要将命令中/mnt改为/var/www/html/owncloud/data/admin/files，uid和gid值改为apache的uid和gid</p>
</li>
<li>
<p>10、切换至命令行终端页面，执行上一步骤的修改后的挂载命令</p>
</li>
<li>
<p>11、执行以下命令查看挂载是否成功</p>
</li>
</ul>
<pre><code>df -h | grep aliyun
</code></pre>
<p>注意：NAS挂载成功后，OwnCloud网盘中的默认目录和文件不可读写，请在网盘中新建目录上传</p>
<ul>
<li>12、可以在OwnCloud网盘中，新建文件夹并上传文件，并且可以在/var/www/html/owncloud/data/admin/files目录下查找到您上传的文件</li>
</ul>
<h3 id="配置相应的shell脚本">配置相应的shell脚本</h3>
<p>待后续研究</p>
<h3 id="一键部署">一键部署</h3>
<p><strong>使用限制：</strong><br>
1、仅支持ECS Linux操作系统。其中，CoreOS、FreeBSD和Fedora-CoreOS版本不支持使用控制台一键挂载功能。</p>
<h3 id="心得">心得：</h3>
<p>1、配置还是比较麻烦的，如果是几十或者上百服务器，最好的做法是利用shell脚本一键配置。<br>
2、服务器部分还是只会各个部分的管理操作不会进行对应用户的授权，将来需要打磨的地方</p>

            </div>
            
            
              <div class="next-post">
                <div class="next">下一篇</div>
                <a href="https://bingery111.github.io/post/ecs-pei-zhi/">
                  <h3 class="post-title">
                    ECS配置
                  </h3>
                </a>
              </div>
            

            

          </div>

        </div>
      </div>
    </div>

    <script src="https://unpkg.com/aos@next/dist/aos.js"></script>
<script type="application/javascript">

AOS.init();

var app = new Vue({
  el: '#app',
  data: {
    menuVisible: false,
  },
})

</script>






  </body>
</html>
