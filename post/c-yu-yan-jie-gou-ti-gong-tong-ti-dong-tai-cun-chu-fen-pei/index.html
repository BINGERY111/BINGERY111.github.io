<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" >

<title>（C语言）结构体、共同体、动态存储分配 | 个人笔记</title>

<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">

<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.7.2/css/all.css" integrity="sha384-fnmOCqbTlWIlj8LyTjo7mOUStjsKC4pOpQbqyi7RrhN7udi9RwhKkMHpvLbHG9Sr" crossorigin="anonymous">
<link rel="shortcut icon" href="https://bingery111.github.io/favicon.ico?v=1646293310979">
<link rel="stylesheet" href="https://bingery111.github.io/styles/main.css">



<link rel="stylesheet" href="https://unpkg.com/aos@next/dist/aos.css" />
<script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>



    <meta name="description" content="
一、结构体与共用体

1.1 结构体
1.2 共用体


二、宏定义与用户自定义类型

2.1 宏定义
2.2 用户自定义类型


三、动态存储分配

3.1 静态存储分配
3.2 动态存储分配
3.3 举 2 个例子

3.3.1 案例..." />
    <meta name="keywords" content="" />
  </head>
  <body>
    <div id="app" class="main">

      <div class="sidebar" :class="{ 'full-height': menuVisible }">
  <div class="top-container" data-aos="fade-right">
    <div class="top-header-container">
      <a class="site-title-container" href="https://bingery111.github.io">
        <img src="https://bingery111.github.io/images/avatar.png?v=1646293310979" class="site-logo">
        <h1 class="site-title">个人笔记</h1>
      </a>
      <div class="menu-btn" @click="menuVisible = !menuVisible">
        <div class="line"></div>
      </div>
    </div>
    <div>
      
        
          <a href="/" class="site-nav">
            首页
          </a>
        
      
        
          <a href="/archives" class="site-nav">
            归档
          </a>
        
      
        
          <a href="/tags" class="site-nav">
            标签
          </a>
        
      
        
          <a href="/post/about" class="site-nav">
            关于
          </a>
        
      
    </div>
  </div>
  <div class="bottom-container" data-aos="flip-up" data-aos-offset="0">
    <div class="social-container">
      
        
      
        
      
        
      
        
      
        
      
    </div>
    <div class="site-description">
      向上攀爬之路不是比站在顶峰更让人热血澎湃吗
    </div>
    <div class="site-footer">
      Powered by <a href="https://github.com/getgridea/gridea" target="_blank">Gridea</a> | <a class="rss" href="https://bingery111.github.io/atom.xml" target="_blank">RSS</a>
    </div>
  </div>
</div>


      <div class="main-container">
        <div class="content-container" data-aos="fade-up">
          <div class="post-detail">
            <h2 class="post-title">（C语言）结构体、共同体、动态存储分配</h2>
            <div class="post-date">2022-02-15</div>
            
            <div class="post-content" v-pre>
              <ul>
<li><a href="#%E4%B8%80%E7%BB%93%E6%9E%84%E4%BD%93%E4%B8%8E%E5%85%B1%E7%94%A8%E4%BD%93">一、结构体与共用体</a>
<ul>
<li><a href="#11-%E7%BB%93%E6%9E%84%E4%BD%93">1.1 结构体</a></li>
<li><a href="#12-%E5%85%B1%E7%94%A8%E4%BD%93">1.2 共用体</a></li>
</ul>
</li>
<li><a href="#%E4%BA%8C%E5%AE%8F%E5%AE%9A%E4%B9%89%E4%B8%8E%E7%94%A8%E6%88%B7%E8%87%AA%E5%AE%9A%E4%B9%89%E7%B1%BB%E5%9E%8B">二、宏定义与用户自定义类型</a>
<ul>
<li><a href="#21-%E5%AE%8F%E5%AE%9A%E4%B9%89">2.1 宏定义</a></li>
<li><a href="#22-%E7%94%A8%E6%88%B7%E8%87%AA%E5%AE%9A%E4%B9%89%E7%B1%BB%E5%9E%8B">2.2 用户自定义类型</a></li>
</ul>
</li>
<li><a href="#%E4%B8%89%E5%8A%A8%E6%80%81%E5%AD%98%E5%82%A8%E5%88%86%E9%85%8D">三、动态存储分配</a>
<ul>
<li><a href="#31-%E9%9D%99%E6%80%81%E5%AD%98%E5%82%A8%E5%88%86%E9%85%8D">3.1 静态存储分配</a></li>
<li><a href="#32-%E5%8A%A8%E6%80%81%E5%AD%98%E5%82%A8%E5%88%86%E9%85%8D">3.2 动态存储分配</a></li>
<li><a href="#33-%E4%B8%BE-2-%E4%B8%AA%E4%BE%8B%E5%AD%90">3.3 举 2 个例子</a>
<ul>
<li><a href="#331-%E6%A1%88%E4%BE%8B-1">3.3.1 案例 1</a></li>
<li><a href="#332-%E6%A1%88%E4%BE%8B-2">3.3.2 案例 2</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#%E5%9B%9B%E8%AF%B4%E6%98%8E">四、说明</a></li>
</ul>
<h2 id="一-结构体与共用体">一、结构体与共用体</h2>
<h3 id="11-结构体">1.1 结构体</h3>
<pre><code class="language-c">学生成绩，对于每一个学生，需要考察的一些信息，这就是现实问题
char Id[9];    //学号
char Name[15]; //姓名
int Age;      //年龄
double Score; //成绩
</code></pre>
<p>要管理学生，每个学生要考虑的维度比较多，没有哪一种数据类型可以很好的刻画这种关系，此时就需要多个类型来共同定义，形成新的数据类型，也就是结构体！</p>
<pre><code class="language-c">struct STUDENT_INFO { //结构体定义
    char Id[9];    
    char Name[15]; 
    int Age;      
    double Score; 
};

struct STUDENT_INFO a; //这个 a 就是结构体数据类型的一个实例，里面是包含那么几个变量的。
//结构体的长度是所有成员的长度之和
</code></pre>
<p><strong>结构体是 C 语言具有“自我扩充能力”的重要机制。</strong></p>
<p>C 语言的基本数据类型有七大类型，这些类型都是由 C 系统提前确定的；而结构体类型是由用户根据自身需要而定义的，是 C 系统本身不具备的，这是 C 语言革命性的一步。</p>
<p><strong>结构体是对 C 语言数据类型的强力扩充！</strong></p>
<p>注意：结构体的定义本身仅仅是“设计、蓝图”，并不占内存空间，当将其实例化后，这个实例才真正的占用存储空间。</p>
<ul>
<li>. 运算符，结构体实例取其成员的运算符；</li>
<li>-&gt; 运算符，指向结构体实例的指针取其成员的运算符；</li>
</ul>
<p>定义结构体时，赋初值的初值顺序，必须保证与结构体中成员数据类型是一致的；<strong>两个完全一模一样的结构体实例，之间是可以进行赋值操作的。</strong></p>
<h3 id="12-共用体">1.2 共用体</h3>
<pre><code class="language-c">union TEST {
    int a;
    char b;
    double c;
}

union TEST a, *p = &amp;a;
a.a  &lt;==&gt;  p-&gt;a
a.b  &lt;==&gt;  p-&gt;b
a.c  &lt;==&gt;  p-&gt;c
//两边表达的是一个意思，就是取共用体成员的值
</code></pre>
<p>共用体的诸成员共同使用同一起始地址空间。</p>
<p>共用体内存映像图：</p>
<div align=center><img src='https://mmbiz.qpic.cn/mmbiz_jpg/iaumSdLKJXtTwZB8LiaRYnjhTUmBtEfnWeyTsxxOGM3WuAMNxJnWrHLKsib3PlicQiaCS9unF5UqPtibJ00TvkZhN39A/640?wx_fmt=jpeg&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1'></div>
<p align=center>(共用体内存映像图)</p>
<p><strong>共用体空间大小取决于共用体中，长度最长的成员的长度。</strong></p>
<pre><code class="language-c">sizeof(union TEST)  -&gt; 8B
</code></pre>
<h2 id="二-宏定义与用户自定义类型">二、宏定义与用户自定义类型</h2>
<h3 id="21-宏定义">2.1 宏定义</h3>
<p>#define 标识符，被替换的信息（<strong>这里不能随便出现分号</strong>）</p>
<pre><code class="language-c">#define  PI  3.1415926
...
    a = PI * r * r; &lt;=&gt; a = 3.1415926 * r * r;

#define NUM 3+4
...
    a = NUM * 3 / NUM; &lt;=&gt; a = 3+4 * 3 / 3+4

//深入理解：只替换，不计算
</code></pre>
<p>宏替换不能改变运算量，就是简简单单的完全替换就好。</p>
<p>宏替换被广泛使用的关键在于以下两点：</p>
<ol>
<li><strong>提高程序的可维护性</strong>：就是针对同一个数字，可能在代码中多次出现，为了方便修改，上面用个宏替换，可以达到只修改一处，其他的地方都被修改的好处。</li>
<li><strong>提高程序的可读性</strong>：用宏替换，便于理解每一个数字所代表的人文化含义，可以知道代表的是什么意思。</li>
</ol>
<p><strong>神仙数字</strong>：是指在程序中出现的常量数值，尤其是整型常量数值，一看根本不知道是啥意思，没有任何代表含义的数字。</p>
<h3 id="22-用户自定义类型">2.2 用户自定义类型</h3>
<p>typedef 是关键字；</p>
<p>格式：typedef  已有类型  新类型;</p>
<pre><code class="language-c">typedef int a, b, c;
//上述语句将产生 3 个新的数据类型，分别为：a, b, c
int n;  &lt;=&gt;  a n;  //此时 a 就代表 int 数据类型

#define DI int *
typedef int * TI; //这条语句所产生的新类型是 TI，其对应的数据类型是 int *
</code></pre>
<p>其实用define、typedef 声明新的数据类型，两者在碰到指针、数组、以及结构体时，所体现的情况均不一样，一定要小心分析这些情况，尽量用 typedef 声明你想要的新数据类型，具体的在 C 语言进阶中写。</p>
<h2 id="三-动态存储分配">三、动态存储分配</h2>
<h3 id="31-静态存储分配">3.1 静态存储分配</h3>
<p>以前所定义的变量，数组统统属于静态存储分配方式。</p>
<pre><code class="language-c">int a, b[50];
</code></pre>
<p>在源程序级别，用静态存储分配定义的变量和数组，其空间大小一经定义，终生不变！所以说是“静态”的，这使得程序的适应性受到了极大的限制。</p>
<p>我此时希望代码在运行的过程中，根据我们临时需要，“动态”地申请存储空间。</p>
<h3 id="32-动态存储分配">3.2 动态存储分配</h3>
<p>动态存储分配是通过两个函数完成的：malloc() 和 free()，前者用来申请空间，后者用来释放空间。</p>
<pre><code class="language-c">#include &lt;malloc.h&gt;

int *p;
p = (int *)malloc(1000); //申请了 1000B 空间，也就是 250 个 int 元素的数组
//到了这里，C 语言的数组彻底失去它存在的意义！
free(首地址);  //释放以 p 的值为首地址的空间。
</code></pre>
<h3 id="33-举-2-个例子">3.3 举 2 个例子</h3>
<h4 id="331-案例-1">3.3.1 案例 1</h4>
<pre><code class="language-c">#include &lt;malloc.h&gt;
  
int *p; i;
for (i = 0; i &lt; 3; i++) {
    p = (int *)malloc(sizeof(int) * 30);
}
...

for (i = 0; i &lt; 3; i++) {
    free(p);  //释放以 p 的值为首地址的空间
}
</code></pre>
<p><strong>分析：</strong></p>
<ul>
<li><strong>多次申请空间，将所得到的空间的首地址赋值给 p 变量；由于赋值的特点是覆盖，因此，最终 p 变量中仅保持了最后一次申请得到的空间的首地址，以前所申请空间的首地址被覆盖了（遗失了）；使得那些空间不但不能再使用，甚至还不能释放！这称为“内存泄露”！</strong></li>
<li><strong>free(p) 进行了多次对同一首地址空间的释放操作，这是致命的运行时错误！</strong></li>
</ul>
<h4 id="332-案例-2">3.3.2 案例 2</h4>
<pre><code class="language-c">#include &lt;malloc.h&gt;
#include &lt;stdio.h&gt;
 
int *fun() {
    int a[20];  //动态存储分配将不会出现以下的问题

    return a;
}

int main (void) {
    int *p1;

    p1 = fun();
    free(p1);
}
</code></pre>

            </div>
            
            
              <div class="next-post">
                <div class="next">下一篇</div>
                <a href="https://bingery111.github.io/post/c-yu-yan-jie-gou-hua-cheng-xu-she-ji/">
                  <h3 class="post-title">
                    （C语言）结构化程序设计
                  </h3>
                </a>
              </div>
            

            

          </div>

        </div>
      </div>
    </div>

    <script src="https://unpkg.com/aos@next/dist/aos.js"></script>
<script type="application/javascript">

AOS.init();

var app = new Vue({
  el: '#app',
  data: {
    menuVisible: false,
  },
})

</script>






  </body>
</html>
